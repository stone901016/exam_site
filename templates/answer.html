<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <title>第 {{ question.id }} 題 答案</title>
</head>
<body>
  <h2 class="question-title">第 {{ question.id }} 題：{{ question.title }} — 答案</h2>

{% if question.id == 1 %}
  {% set cn_map = {
    "best_dist_amt":   "最佳分布（賠償金額）",
    "best_params_amt": "參數（賠償金額）",
    "aic_amt":         "AIC（賠償金額）",
    "best_dist_rat":   "最佳分布（賠款率）",
    "best_params_rat": "參數（賠款率）",
    "aic_rat":         "AIC（賠款率）",
    "var_hist_amt":    "歷史 VaR（賠償金額）",
    "cvar_hist_amt":   "歷史 CVaR（賠償金額）",
    "var_hist_rat":    "歷史 VaR（賠款率）",
    "cvar_hist_rat":   "歷史 CVaR（賠款率）",
    "var_mc_amt":      "MC VaR（賠償金額）",
    "cvar_mc_amt":     "MC CVaR（賠償金額）",
    "var_mc_rat":      "MC VaR（賠款率）",
    "cvar_mc_rat":     "MC CVaR（賠款率）"
  } %}
  {% set cn_map_plots = {
    "pdf_amount": "賠償金額 PDF",
    "pdf_ratio":  "賠款率 PDF"
  } %}
{% endif %}

  
  {# 中文對照字典 #}
  {% set cn_map = {} %}
  {% set cn_map_plots = {} %}
  {% if question.id == 3 %}
    {% set cn_map = {
      "sensitivity_std": "靈敏度 (收益標準差)",
      "prob_profit_gt_100": "P(收益>100) 機率"
    } %}
    {% set cn_map_plots = {
      "dist": "Profit 分布比較圖",
      "p_gt100": "P(Profit>100) 變化圖"
    } %}
  {% endif %}

  <div class="answer-box">
    {% for key, val in result.items() if key != 'plots' %}
      <div style="margin-bottom: 1em;">
        <strong>{{ cn_map[key] if cn_map.get(key) else key }}</strong>：
        {% if val is mapping %}
          <table class="result-table">
            <thead><tr><th>參數</th><th>數值</th></tr></thead>
            <tbody>
              {% for k, v in val.items() %}
                <tr>
                  <td>{{ k }}</td>
                  <td>{{ '{:.4f}'.format(v) if v is number else v }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          {{ val }}
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {% if result.plots %}
    <h3 class="question-title">圖表</h3>
    <div class="plot-box">
      {% for label, fn in result.plots.items() %}
        <div class="plot-item">
          <img src="{{ url_for('static', filename='results/' + fn) }}" alt="{{ label }}">
          <p>{{ cn_map_plots[label] if cn_map_plots.get(label) else label }}</p>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <p><a href="{{ url_for('question', qid=question.id) }}">重新產生答案</a> |
     <a href="{{ url_for('index') }}">回首頁</a></p>
</body>
</html>
